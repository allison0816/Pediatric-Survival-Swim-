<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric Survival Swim Schedule</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #e0f2f7, #f0fdfa); /* Subtle teal-to-light-teal gradient background */
            color: #115e59; /* Dark teal text for contrast */
            overflow-x: hidden; /* Prevent horizontal scroll from floating elements */
            position: relative;
        }
        .container {
            max-width: 1700px; /* Even wider container for spacious feel */
            margin: 0 auto;
            padding: 2.5rem; /* Increased padding */
            position: relative; /* For z-index context */
            z-index: 10; /* Ensure content is above floating elements */
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.75rem; /* Slightly more rounded */
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); /* Deeper shadow for more depth */
            padding: 2.5rem; /* Increased padding */
            margin-bottom: 2.5rem; /* Increased margin */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid #e0f2f7; /* Subtle teal border */
        }
        .card:hover {
            transform: translateY(-10px); /* More pronounced lift on hover */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }
        .instructor-card {
            background-color: #ffffff; /* Keep white for instructor cards */
            border: 2px solid #5eead4; /* Bright teal border */
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08); /* Lighter shadow for inner cards */
        }
        .time-slot {
            background-color: #99f6e4; /* Medium teal for available slots */
            border-radius: 0.75rem;
            padding: 0.8rem 1.2rem; /* Slightly more padding */
            margin: 0.6rem; /* Slightly more margin */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            font-weight: 600;
            text-align: center;
            flex-grow: 1;
            min-width: 130px; /* Slightly wider min-width */
            color: #0f766e; /* Darker teal text */
            box-shadow: 0 3px 8px rgba(0,0,0,0.1); /* Subtle shadow for slots */
        }
        .time-slot:hover:not(.booked):not(.my-booking) {
            background-color: #2dd4bf; /* Darker teal on hover */
            color: white;
            transform: translateY(-4px); /* More pronounced lift */
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        .time-slot.booked {
            background-color: #fecaca; /* Light red for booked slots (kept for clear indication) */
            color: #b91c1c; /* Darker red text */
            cursor: not-allowed;
            text-decoration: line-through;
            opacity: 0.7;
            box-shadow: none; /* No shadow for booked */
        }
        .time-slot.my-booking {
            background-color: #fde68a; /* Bright yellow for user's own bookings */
            color: #92400e; /* Dark orange text */
            border: 2px solid #fbbf24; /* Yellow border */
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(253, 230, 138, 0.5); /* Yellow shadow */
        }
        .button-primary {
            background: linear-gradient(to right, #fb923c, #f97316); /* Orange gradient */
            color: white;
            padding: 1rem 2.5rem; /* Larger padding */
            border-radius: 0.75rem;
            font-weight: 700;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 8px 20px rgba(251, 146, 60, 0.4); /* Stronger orange shadow */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1); /* Subtle text shadow */
        }
        .button-primary:hover {
            background: linear-gradient(to right, #f97316, #ea580c); /* Darker orange gradient on hover */
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0 12px 25px rgba(249, 115, 22, 0.5);
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75); /* Slightly darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 3rem; /* More padding */
            border-radius: 1.5rem; /* More rounded */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 500px; /* Wider modal */
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-left-color: #f97316; /* Orange spinner */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Floating Graphics */
        .floating-graphic {
            position: absolute;
            animation: float 6s ease-in-out infinite;
            z-index: 1; /* Below main content */
        }
        .floating-graphic.fish-1 { top: 10%; left: 5%; animation-duration: 7s; animation-delay: 0s; }
        .floating-graphic.starfish-1 { top: 20%; right: 8%; animation-duration: 8s; animation-delay: 1s; }
        .floating-graphic.fish-2 { bottom: 15%; left: 12%; animation-duration: 6.5s; animation-delay: 2s; }
        .floating-graphic.starfish-2 { top: 50%; left: 2%; animation-duration: 7.5s; animation-delay: 0.5s; }
        .floating-graphic.fish-3 { bottom: 5%; right: 15%; animation-duration: 7.2s; animation-delay: 1.5s; }
        .floating-graphic.fish-4 { top: 30%; right: 20%; animation-duration: 6.8s; animation-delay: 0.8s; }
        .floating-graphic.starfish-3 { bottom: 25%; left: 25%; animation-duration: 8.5s; animation-delay: 2.5s; }
        .floating-graphic.fish-5 { top: 60%; left: 18%; animation-duration: 7.8s; animation-delay: 1.2s; }
        .floating-graphic.starfish-4 { top: 5%; right: 30%; animation-duration: 9s; animation-delay: 3s; }
        .floating-graphic.fish-6 { bottom: 35%; right: 5%; animation-duration: 6s; animation-delay: 0.3s; }
        .floating-graphic.fish-7 { top: 45%; left: 5%; animation-duration: 7.3s; animation-delay: 0.7s; }
        .floating-graphic.starfish-5 { bottom: 10%; right: 30%; animation-duration: 8.2s; animation-delay: 1.8s; }
        .floating-graphic.fish-8 { top: 70%; right: 10%; animation-duration: 6.7s; animation-delay: 2.2s; }
        .floating-graphic.fish-9 { top: 25%; left: 40%; animation-duration: 6.9s; animation-delay: 0.6s; }
        .floating-graphic.starfish-6 { bottom: 40%; left: 10%; animation-duration: 8.1s; animation-delay: 1.1s; }


        @keyframes float {
            0% { transform: translateY(0px) translateX(0px); }
            50% { transform: translateY(-15px) translateX(10px); }
            100% { transform: translateY(0px) translateX(0px); }
        }

        /* View Toggle Buttons */
        .view-toggle-button {
            background-color: #d1fae5; /* Light teal */
            color: #0f766e; /* Dark teal */
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid #99f6e4;
        }
        .view-toggle-button:hover {
            background-color: #5eead4; /* Brighter teal */
            color: white;
        }
        .view-toggle-button.active {
            background-color: #2dd4bf; /* Active teal */
            color: white;
            box-shadow: 0 4px 10px rgba(45, 212, 191, 0.4);
        }

        /* Adjustments for smaller screens */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .card {
                padding: 1.5rem;
            }
            .header h1 {
                font-size: 3.5rem;
            }
            .header p {
                font-size: 1rem;
            }
            .button-primary {
                padding: 0.75rem 1.5rem;
            }
            .floating-graphic {
                display: none; /* Hide floating graphics on very small screens */
            }
            .view-toggle-group {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body class="p-4">
    <!-- Floating Graphics -->
    <div class="floating-graphic fish-1">
        <svg class="w-16 h-16 text-teal-300 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-1">
        <svg class="w-16 h-16 text-yellow-300 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>
    <div class="floating-graphic fish-2">
        <svg class="w-20 h-20 text-orange-300 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-2">
        <svg class="w-20 h-20 text-teal-400 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>
    <div class="floating-graphic fish-3">
        <svg class="w-18 h-18 text-yellow-400 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic fish-4">
        <svg class="w-14 h-14 text-teal-200 opacity-70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-3">
        <svg class="w-18 h-18 text-orange-200 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>
    <div class="floating-graphic fish-5">
        <svg class="w-22 h-22 text-yellow-300 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-4">
        <svg class="w-14 h-14 text-teal-500 opacity-40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>
    <div class="floating-graphic fish-6">
        <svg class="w-16 h-16 text-orange-400 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic fish-7">
        <svg class="w-18 h-18 text-teal-400 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-5">
        <svg class="w-16 h-16 text-yellow-200 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>
    <div class="floating-graphic fish-8">
        <svg class="w-20 h-20 text-orange-300 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic fish-9">
        <svg class="w-14 h-14 text-teal-300 opacity-70" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
    </div>
    <div class="floating-graphic starfish-6">
        <svg class="w-18 h-18 text-yellow-400 opacity-60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
    </div>


    <div class="container">
        <!-- Header Section -->
        <header class="text-center mb-12 py-10 bg-gradient-to-br from-teal-500 to-teal-700 text-white rounded-3xl shadow-xl transform transition-transform duration-300 hover:scale-105 relative">
            <h1 class="text-6xl font-extrabold mb-4 tracking-tight drop-shadow-lg">Pediatric Survival Swim Schedule</h1>
            <p class="text-xl font-light opacity-90 mb-6">Empowering children with life-saving aquatic skills.</p>
            <a id="registrationLink" href="https://www.pediatricsurvivalswim.com/pediatricsurvivalswim-1" target="_blank" class="button-primary inline-block text-lg">
                New Swimmers: Register Here!
            </a>
            <!-- Small fish/starfish in header -->
            <div class="absolute top-4 left-8">
                <svg class="w-8 h-8 text-yellow-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
            </div>
            <div class="absolute bottom-4 right-8">
                <svg class="w-8 h-8 text-orange-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.25l-6.18 3.25L7 14.14l-5-4.87 8.91-1.01L12 2z"/></svg>
            </div>
        </header>

        <!-- User ID Display -->
        <div class="text-center text-sm text-gray-700 mb-8 p-3 bg-teal-50 rounded-xl shadow-inner border border-teal-200">
            Your Session ID: <span id="userIdDisplay" class="font-mono text-teal-900 font-semibold break-all">Loading...</span>
            <p class="text-xs mt-1 text-gray-500">This ID helps us track your bookings for this session.</p>
        </div>

        <!-- Existing Swimmers Section -->
        <section class="card">
            <h2 class="text-4xl font-extrabold text-teal-800 mb-8 text-center">Existing Swimmers: Select Your Class</h2>

            <!-- View Toggles -->
            <div class="flex justify-center gap-4 mb-8 view-toggle-group">
                <button id="dailyViewBtn" class="view-toggle-button active" data-view="daily">Daily View</button>
                <button id="weeklyViewBtn" class="view-toggle-button" data-view="weekly">Weekly View</button>
                <button id="monthlyViewBtn" class="view-toggle-button" data-view="monthly">Monthly View</button>
            </div>

            <div id="loadingIndicator" class="text-center py-12">
                <div class="spinner"></div>
                <p class="mt-4 text-teal-700 text-lg">Loading schedules, please wait...</p>
            </div>

            <div id="scheduleContent" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Instructor Sections will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- My Bookings Section -->
        <section class="card bg-gradient-to-r from-yellow-100 to-yellow-200 mt-8 border-yellow-300">
            <h2 class="text-4xl font-extrabold text-yellow-800 mb-8 text-center flex items-center justify-center gap-4">
                <svg class="w-10 h-10 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.6 10.4c-.6-.7-1.4-1.2-2.3-1.5-.9-.3-1.9-.4-2.9-.3-.9.1-1.8.4-2.6.9-.8.5-1.5 1.2-2 2-.5.8-.8 1.7-.8 2.7s.3 1.9.8 2.7c.5.8 1.2 1.5 2 2 .8.5 1.7.8 2.6.9.9.1 1.9 0 2.9-.3.9-.3 1.7-.8 2.3-1.5.6-.7 1.1-1.5 1.4-2.5.3-.9.4-1.9.3-2.9-.1-.9-.4-1.8-.9-2.6zm-1.8 4.2c-.3.3-.7.5-1.1.6-.4.1-.8.1-1.2 0-.4-.1-.8-.3-1.1-.6-.3-.3-.5-.7-.6-1.1-.1-.4-.1-.8 0-1.2.1-.4.3-.8.6-1.1.3-.3.7-.5 1.1-.6.4-.1.8-.1 1.2 0 .4.1.8.3 1.1.6.3.3.5.7.6 1.1.1.4.1.8 0 1.2zM22 12c0 1.1-.2 2.1-.6 3.1-.4 1-.9 1.9-1.6 2.7-.7.8-1.5 1.4-2.5 1.9-1 .5-2.1.8-3.2.8-1.1 0-2.2-.2-3.2-.6-1-.4-1.9-.9-2.7-1.6-.8-.7-1.4-1.5-1.9-2.5-.5-1-.8-2.1-.8-3.2s.2-2.1.6-3.1c.4-1 .9-1.9 1.6-2.7.7-.8 1.5-1.4 2.5-1.9 1-.5 2.1-.8 3.2-.8 1.1 0 2.2.2 3.2.6 1 .4 1.9.9 2.7 1.6.8.7 1.4 1.5 1.9 2.5.5 1 .8 2.1.8 3.2z"/></svg>
                My Bookings
            </h2>
            <div id="myBookingsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <p class="text-center text-yellow-700 text-lg col-span-full py-4">No bookings yet. Select a class above!</p>
            </div>
        </section>

        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="modal hidden">
            <div class="modal-content">
                <h3 class="text-3xl font-bold text-teal-800 mb-4">Confirm Booking</h3>
                <p id="modalMessage" class="text-xl text-gray-700 mb-8"></p>
                <div class="flex justify-center space-x-6">
                    <button id="confirmButton" class="button-primary px-8 py-3">Confirm</button>
                    <button id="cancelButton" class="bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-colors shadow-md">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Message Modal (for success/error) -->
        <div id="messageModal" class="modal hidden">
            <div class="modal-content">
                <h3 id="messageModalTitle" class="text-3xl font-bold text-teal-800 mb-4"></h3>
                <p id="messageModalText" class="text-xl text-gray-700 mb-8"></p>
                <button id="messageModalCloseButton" class="button-primary px-8 py-3">OK</button>
            </div>
        </div>

        <!-- Footer Section -->
        <footer class="text-center mt-16 py-8 text-gray-600 text-sm border-t border-gray-300 pt-8">
            <p>&copy; 2025 Pediatric Survival Swim. All rights reserved. Protected by Copyright Law.</p>
        </footer>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let currentUserId = null;
        let isAuthReady = false;
        let allClasses = []; // To store all fetched classes

        const instructors = ["Allison", "Brittany", "Christina"];
        // Updated time slots to 15-minute intervals
        const timeSlots = [
            "9:00 AM", "9:15 AM", "9:30 AM", "9:45 AM",
            "10:00 AM", "10:15 AM", "10:30 AM", "10:45 AM",
            "11:00 AM", "11:15 AM", "11:30 AM", "11:45 AM",
            "1:00 PM", "1:15 PM", "1:30 PM", "1:45 PM",
            "2:00 PM", "2:15 PM", "2:30 PM", "2:45 PM",
            "3:00 PM", "3:15 PM", "3:30 PM", "3:45 PM"
        ];
        // Extend daysOfWeek to ensure enough data for weekly/monthly views
        const daysOfWeek = ["Wednesday", "Thursday", "Friday", "Saturday", "Sunday", "Monday", "Tuesday"]; // Cycle through days

        // SVG icons for marine animals (simplified for brevity, using common shapes)
        const marineAnimalIcons = {
            "Allison": `<svg class="w-8 h-8 text-teal-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"/></svg>`, // Placeholder for Dolphin
            "Brittany": `<svg class="w-8 h-8 text-orange-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M14.5 8c-.83 0-1.5.67-1.5 1.5V10h-2V9.5c0-.83-.67-1.5-1.5-1.5S8 8.67 8 9.5V10H6V9.5c0-.83-.67-1.5-1.5-1.5S3 8.67 3 9.5V10h-1V9.5c0-.83-.67-1.5-1.5-1.5S0 8.67 0 9.5V10c0 1.1.9 2 2 2h1v1h2v-1h2v1h2v-1h2v1h2v-1h1c1.1 0 2-.9 2-2V9.5c0-.83-.67-1.5-1.5-1.5zM12 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM12 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>`, // Placeholder for Shark
            "Christina": `<svg class="w-8 h-8 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c-3.31 0-6 2.69-6 6v6c0 3.31 2.69 6 6 6s6-2.69 6-6V8c0-3.31-2.69-6-6-6zm0 10c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm0-6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>` // Placeholder for Turtle
        };

        // More fish and starfish for floating graphics (using existing fish/starfish paths)
        const floatingGraphicsData = [
            { class: "fish-1", color: "text-teal-300", opacity: "opacity-60", size: "w-16 h-16", duration: "7s", delay: "0s" },
            { class: "starfish-1", color: "text-yellow-300", opacity: "opacity-60", size: "w-16 h-16", duration: "8s", delay: "1s" },
            { class: "fish-2", color: "text-orange-300", opacity: "opacity-50", size: "w-20 h-20", duration: "6.5s", delay: "2s" },
            { class: "starfish-2", color: "text-teal-400", opacity: "opacity-50", size: "w-20 h-20", duration: "7.5s", delay: "0.5s" },
            { class: "fish-3", color: "text-yellow-400", opacity: "opacity-60", size: "w-18 h-18", duration: "7.2s", delay: "1.5s" },
            { class: "fish-4", color: "text-teal-200", opacity: "opacity-70", size: "w-14 h-14", duration: "6.8s", delay: "0.8s" },
            { class: "starfish-3", color: "text-orange-200", opacity: "opacity-60", size: "w-18 h-18", duration: "8.5s", delay: "2.5s" },
            { class: "fish-5", color: "text-yellow-300", opacity: "opacity-50", size: "w-22 h-22", duration: "7.8s", delay: "1.2s" },
            { class: "starfish-4", color: "text-teal-500", opacity: "opacity-40", size: "w-14 h-14", duration: "9s", delay: "3s" },
            { class: "fish-6", color: "text-orange-400", opacity: "opacity-50", size: "w-16 h-16", duration: "6s", delay: "0.3s" },
            { class: "fish-7", color: "text-teal-400", opacity: "opacity-60", size: "w-18 h-18", duration: "7.3s", delay: "0.7s" },
            { class: "starfish-5", color: "text-yellow-200", opacity: "opacity-50", size: "w-16 h-16", duration: "8.2s", delay: "1.8s" },
            { class: "fish-8", color: "text-orange-300", opacity: "opacity-50", size: "w-20 h-20", duration: "6.7s", delay: "2.2s" },
            { class: "fish-9", color: "text-teal-300", opacity: "opacity-70", size: "w-14 h-14", duration: "7.1s", delay: "0.4s" },
            { class: "starfish-6", color: "text-yellow-400", opacity: "opacity-60", size: "w-18 h-18", duration: "8.8s", delay: "2.8s" }
        ];


        const loadingIndicator = document.getElementById('loadingIndicator');
        const scheduleContent = document.getElementById('scheduleContent').querySelector('div.grid'); // Target the grid inside scheduleContent
        const userIdDisplay = document.getElementById('userIdDisplay');
        const myBookingsList = document.getElementById('myBookingsList');
        const registrationLinkElement = document.getElementById('registrationLink');

        const confirmationModal = document.getElementById('confirmationModal');
        const modalMessage = document.getElementById('modalMessage');
        const confirmButton = document.getElementById('confirmButton');
        const cancelButton = document.getElementById('cancelButton');

        const messageModal = document.getElementById('messageModal');
        const messageModalTitle = document.getElementById('messageModalTitle');
        const messageModalText = document.getElementById('messageModalText');
        const messageModalCloseButton = document.getElementById('messageModalCloseButton');

        const dailyViewBtn = document.getElementById('dailyViewBtn');
        const weeklyViewBtn = document.getElementById('weeklyViewBtn');
        const monthlyViewBtn = document.getElementById('monthlyViewBtn');

        let pendingBooking = null; // Stores details of the slot being confirmed
        let currentView = 'daily'; // Default view

        /**
         * Sets the registration link.
         * @param {string} url - The URL for the registration page.
         */
        function setRegistrationLink(url) {
            registrationLinkElement.href = url;
        }

        // Call this function with your actual registration link
        setRegistrationLink("https://www.pediatricsurvivalswim.com/pediatricsurvivalswim-1"); // Placeholder: Please replace with your actual link

        /**
         * Initializes Firebase and sets up authentication.
         */
        async function initializeFirebase() {
            try {
                // Initialize Firebase app
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in with custom token if available, otherwise anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        userIdDisplay.textContent = currentUserId;
                        isAuthReady = true;
                        console.log("Firebase initialized and authenticated. User ID:", currentUserId);
                        // Once authenticated, start listening for data
                        listenForScheduleUpdates();
                    } else {
                        currentUserId = null;
                        userIdDisplay.textContent = 'Not authenticated';
                        isAuthReady = false;
                        console.log("User signed out or not authenticated.");
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or authenticating:", error);
                showModal("Error", "Failed to initialize the app. Please try again later.");
            }
        }

        /**
         * Displays a custom modal with a title and message.
         * @param {string} title - The title for the modal.
         * @param {string} message - The message content for the modal.
         */
        function showModal(title, message) {
            messageModalTitle.textContent = title;
            messageModalText.textContent = message;
            messageModal.classList.remove('hidden');
        }

        /**
         * Hides the message modal.
         */
        function hideMessageModal() {
            messageModal.classList.add('hidden');
        }

        messageModalCloseButton.addEventListener('click', hideMessageModal);

        /**
         * Populates initial schedule data if the collection is empty.
         * This is for demonstration purposes. In a real app, this might be done via an admin panel.
         */
        async function populateInitialSchedule() {
            const classesRef = collection(db, `artifacts/${appId}/public/data/swimClasses`);
            const snapshot = await getDocs(classesRef);

            if (snapshot.empty) {
                console.log("No existing classes found. Populating initial schedule...");
                const batch = [];
                const today = new Date();
                today.setHours(0,0,0,0); // Normalize today to start of day

                // Generate classes for the next 30 days to support monthly view
                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    const formattedDate = date.toISOString().split('T')[0]; // YYYY-MM-DD

                    instructors.forEach(instructor => {
                        timeSlots.forEach(time => {
                            batch.push({
                                instructor: instructor,
                                date: formattedDate,
                                time: time,
                                isBooked: false,
                                bookedBy: '',
                                timestamp: new Date()
                            });
                        });
                    });
                }

                for (const classData of batch) {
                    try {
                        await addDoc(classesRef, classData);
                    } catch (e) {
                        console.error("Error adding document: ", e);
                    }
                }
                console.log("Initial schedule populated.");
            } else {
                console.log("Schedule already exists, skipping initial population.");
            }
        }

        /**
         * Filters classes based on the selected view (daily, weekly, monthly).
         * @param {Array<Object>} classes - All class objects.
         * @param {string} view - The selected view ('daily', 'weekly', 'monthly').
         * @returns {Array<Object>} Filtered classes.
         */
        function filterClassesByView(classes, view) {
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize to start of day

            return classes.filter(cls => {
                // Ensure date and time are strings before creating Date objects
                const classDateStr = String(cls.date);
                const classTimeStr = String(cls.time);
                const classDateTime = new Date(`${classDateStr} ${classTimeStr}`);

                if (isNaN(classDateTime.getTime())) { // Check for invalid date
                    console.warn("Invalid date/time for class:", cls);
                    return false; // Exclude invalid entries
                }

                const classDate = new Date(classDateTime); // Use the valid date object
                classDate.setHours(0, 0, 0, 0);

                if (classDate < today) {
                    return false;
                }

                switch (view) {
                    case 'daily':
                        return classDate.toDateString() === today.toDateString();
                    case 'weekly':
                        const oneWeekFromNow = new Date(today);
                        oneWeekFromNow.setDate(today.getDate() + 7);
                        oneWeekFromNow.setHours(0,0,0,0);
                        return classDate >= today && classDate < oneWeekFromNow;
                    case 'monthly':
                        const oneMonthFromNow = new Date(today);
                        oneMonthFromNow.setMonth(today.getMonth() + 1);
                        oneMonthFromNow.setHours(0,0,0,0);
                        return classDate >= today && classDate < oneMonthFromNow;
                    default:
                        return true;
                }
            });
        }

        /**
         * Renders the schedule based on the provided class data and current view.
         * @param {Array<Object>} classes - Array of class objects from Firestore.
         */
        function renderSchedule(classes) {
            scheduleContent.innerHTML = ''; // Clear previous content
            myBookingsList.innerHTML = ''; // Clear my bookings

            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize to start of day

            // Render My Bookings (always show all future/past bookings)
            const myBookings = classes.filter(cls => cls.bookedBy === currentUserId);
            if (myBookings.length > 0) {
                myBookings.sort((a, b) => {
                    const dateA = new Date(`${a.date} ${a.time}`);
                    const dateB = new Date(`${b.date} ${b.time}`);
                    return dateA - dateB;
                });

                myBookings.forEach(booking => {
                    const bookingDate = new Date(`${booking.date} ${booking.time}`);
                    const isPast = bookingDate < new Date();

                    const bookingCard = document.createElement('div');
                    bookingCard.className = `card bg-white p-4 rounded-xl shadow-md flex flex-col justify-between ${isPast ? 'opacity-60' : ''}`;
                    bookingCard.innerHTML = `
                        <p class="text-xl font-bold text-yellow-800">${booking.instructor}</p>
                        <p class="text-lg text-gray-700 mt-1">${new Date(booking.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })} at ${booking.time}</p>
                        ${isPast ? '<p class="text-sm text-red-500 mt-3 font-semibold">Past Class</p>' : `<button data-id="${booking.id}" class="cancel-booking-btn mt-4 bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors shadow-md">Cancel Booking</button>`}
                    `;
                    myBookingsList.appendChild(bookingCard);
                });
            } else {
                myBookingsList.innerHTML = '<p class="text-center text-yellow-700 text-lg col-span-full py-4">No bookings yet. Select a class above!</p>';
            }

            let filteredClasses = []; // Initialize filteredClasses to an empty array
            try {
                // Filter classes for the current view
                filteredClasses = filterClassesByView(classes, currentView);
            } catch (e) {
                console.error("Error filtering classes:", e);
                showModal("Error", "Failed to filter schedule data. Please try again.");
                // filteredClasses remains an empty array, preventing further errors.
            }


            instructors.forEach(instructorName => {
                const instructorDiv = document.createElement('div');
                instructorDiv.className = 'card instructor-card';
                // Get the correct marine animal icon for the instructor
                const instructorIcon = marineAnimalIcons[instructorName] || ''; // Default to empty string if no icon found
                instructorDiv.innerHTML = `
                    <h3 class="text-3xl font-bold text-teal-700 mb-6 text-center flex items-center justify-center gap-3">
                        ${instructorName}
                        ${instructorIcon}
                    </h3>
                    <div class="grid grid-cols-1 gap-6" id="instructor-${instructorName.replace(/\s/g, '')}-schedule">
                        <!-- Dates and times will go here -->
                    </div>
                `;
                scheduleContent.appendChild(instructorDiv);

                const instructorScheduleDiv = instructorDiv.querySelector(`#instructor-${instructorName.replace(/\s/g, '')}-schedule`);

                // Group filtered classes by date for each instructor
                const instructorClasses = filteredClasses.filter(cls => cls.instructor === instructorName);
                const groupedByDate = instructorClasses.reduce((acc, cls) => {
                    const date = cls.date;
                    if (!acc[date]) {
                        acc[date] = [];
                    }
                    acc[date].push(cls);
                    return acc;
                }, {});

                const sortedDates = Object.keys(groupedByDate).sort(); // Sort dates chronologically

                if (sortedDates.length === 0) {
                    instructorScheduleDiv.innerHTML = `<p class="text-gray-600 text-center py-4">No classes available for ${instructorName} for the ${currentView} view.</p>`;
                } else {
                    sortedDates.forEach(dateStr => {
                        const dateObj = new Date(dateStr);
                        dateObj.setHours(0, 0, 0, 0); // Normalize to start of day

                        const dateCard = document.createElement('div');
                        dateCard.className = 'bg-teal-50 p-5 rounded-xl shadow-inner border border-teal-100';
                        dateCard.innerHTML = `
                                <h4 class="text-xl font-bold text-teal-600 mb-4">${dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}</h4>
                                <div class="flex flex-wrap justify-center gap-3"></div>
                            `;
                        const timeSlotsContainer = dateCard.querySelector('div.flex');

                        // Sort time slots chronologically
                        const sortedTimeSlots = groupedByDate[dateStr].sort((a, b) => {
                            const timeA = new Date(`2000/01/01 ${a.time}`);
                            const timeB = new Date(`2000/01/01 ${b.time}`);
                            return timeA - timeB;
                        });

                        sortedTimeSlots.forEach(slot => {
                            const slotDateTime = new Date(`${slot.date} ${slot.time}`);
                            const isPastSlot = slotDateTime < new Date();

                            const slotElement = document.createElement('div');
                            slotElement.classList.add('time-slot');
                            slotElement.textContent = slot.time;
                            slotElement.dataset.id = slot.id; // Store Firestore document ID

                            if (slot.isBooked) {
                                slotElement.classList.add('booked');
                                if (slot.bookedBy === currentUserId) {
                                    slotElement.classList.add('my-booking');
                                    slotElement.textContent = `${slot.time} (Yours)`;
                                } else {
                                    slotElement.textContent = `${slot.time} (Booked)`;
                                }
                            } else if (isPastSlot) {
                                slotElement.classList.add('booked'); // Treat past unbooked slots as unavailable
                                slotElement.textContent = `${slot.time} (Past)`;
                            } else {
                                slotElement.addEventListener('click', () => handleSlotClick(slot));
                            }
                            timeSlotsContainer.appendChild(slotElement);
                        });
                        instructorScheduleDiv.appendChild(dateCard);
                    });
                }
            });

            loadingIndicator.classList.add('hidden');
            document.getElementById('scheduleContent').classList.remove('hidden');

            // Add event listeners for cancel buttons after rendering
            document.querySelectorAll('.cancel-booking-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const docId = event.target.dataset.id;
                    if (docId) {
                        showConfirmationModal("Are you sure you want to cancel this booking?", async () => {
                            await cancelBooking(docId);
                            hideConfirmationModal();
                        });
                    }
                });
            });
        }

        /**
         * Handles the click event on a time slot.
         * @param {Object} slot - The class slot object.
         */
        function handleSlotClick(slot) {
            if (!isAuthReady) {
                showModal("Authentication Error", "Please wait while the app authenticates. If this persists, refresh the page.");
                return;
            }
            if (slot.isBooked) {
                showModal("Already Booked", `This slot is already booked by another swimmer.`);
                return;
            }

            const slotDateTime = new Date(`${slot.date} ${slot.time}`);
            if (slotDateTime < new Date()) {
                showModal("Past Slot", "This time slot is in the past and cannot be booked.");
                return;
            }

            pendingBooking = slot;
            modalMessage.textContent = `Do you want to book ${slot.time} on ${new Date(slot.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })} with ${slot.instructor}?`;
            confirmationModal.classList.remove('hidden');
        }

        /**
         * Hides the confirmation modal.
         */
        function hideConfirmationModal() {
            confirmationModal.classList.add('hidden');
            pendingBooking = null;
        }

        /**
         * Shows the confirmation modal and sets up its actions.
         * @param {string} message - The message to display in the modal.
         * @param {Function} onConfirm - Callback function to execute on confirm.
         */
        function showConfirmationModal(message, onConfirm) {
            modalMessage.textContent = message;
            confirmationModal.classList.remove('hidden');

            // Remove previous listeners to prevent multiple calls
            confirmButton.onclick = null;
            cancelButton.onclick = null;

            confirmButton.onclick = onConfirm;
            cancelButton.onclick = hideConfirmationModal;
        }


        /**
         * Books a selected time slot in Firestore.
         * @param {Object} slot - The class slot object to book.
         */
        async function bookSlot(slot) {
            if (!currentUserId) {
                showModal("Error", "User not authenticated. Please refresh the page.");
                return;
            }

            const classRef = doc(db, `artifacts/${appId}/public/data/swimClasses`, slot.id);

            try {
                // Fetch the latest state of the document to prevent race conditions
                const docSnap = await getDoc(classRef);
                if (docSnap.exists()) {
                    const currentData = docSnap.data();
                    if (currentData.isBooked) {
                        showModal("Booking Failed", "This slot was just booked by someone else. Please select another.");
                        return;
                    }

                    await updateDoc(classRef, {
                        isBooked: true,
                        bookedBy: currentUserId
                    });
                    showModal("Success!", `You have successfully booked ${slot.time} on ${new Date(slot.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} with ${slot.instructor}.`);
                } else {
                    showModal("Error", "Class slot not found. It might have been removed.");
                }
            } catch (error) {
                console.error("Error booking slot:", error);
                showModal("Booking Failed", `An error occurred while booking: ${error.message}. Please try again.`);
            } finally {
                hideConfirmationModal();
            }
        }

        /**
         * Cancels a user's booking in Firestore.
         * @param {string} docId - The document ID of the booking to cancel.
         */
        async function cancelBooking(docId) {
            if (!currentUserId) {
                showModal("Error", "User not authenticated. Please refresh the page.");
                return;
            }

            const classRef = doc(db, `artifacts/${appId}/public/data/swimClasses`, docId);

            try {
                const docSnap = await getDoc(classRef);
                if (docSnap.exists()) {
                    const currentData = docSnap.data();
                    if (currentData.bookedBy === currentUserId) {
                        await updateDoc(classRef, {
                            isBooked: false,
                            bookedBy: ''
                        });
                        showModal("Success!", "Your booking has been cancelled.");
                    } else {
                        showModal("Cancellation Failed", "You can only cancel your own bookings.");
                    }
                } else {
                    showModal("Error", "Booking not found.");
                }
            } catch (error) {
                console.error("Error cancelling booking:", error);
                showModal("Cancellation Failed", `An error occurred while cancelling: ${error.message}. Please try again.`);
            } finally {
                hideConfirmationModal();
            }
        }


        // Event listeners for confirmation modal buttons
        confirmButton.addEventListener('click', () => {
            if (pendingBooking) {
                bookSlot(pendingBooking);
            }
        });

        cancelButton.addEventListener('click', hideConfirmationModal);


        /**
         * Sets up a real-time listener for schedule updates from Firestore.
         */
        function listenForScheduleUpdates() {
            const classesRef = collection(db, `artifacts/${appId}/public/data/swimClasses`);
            onSnapshot(classesRef, (snapshot) => {
                allClasses = []; // Update the global allClasses array
                snapshot.forEach(doc => {
                    allClasses.push({ id: doc.id, ...doc.data() });
                });
                console.log("Real-time update received. Total classes:", allClasses.length);
                renderSchedule(allClasses); // Re-render with the current view
            }, (error) => {
                console.error("Error listening to schedule updates:", error);
                showModal("Error", "Failed to load schedule updates. Please refresh the page.");
            });
        }

        /**
         * Handles view toggle button clicks.
         * @param {Event} event - The click event.
         */
        function handleViewToggle(event) {
            document.querySelectorAll('.view-toggle-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            currentView = event.target.dataset.view;
            renderSchedule(allClasses); // Re-render with the new view
        }

        dailyViewBtn.addEventListener('click', handleViewToggle);
        weeklyViewBtn.addEventListener('click', handleViewToggle);
        monthlyViewBtn.addEventListener('click', handleViewToggle);


        // Initialize Firebase when the window loads
        window.onload = async function() {
            await initializeFirebase();
            // Populate initial data only if authenticated and data doesn't exist
            if (isAuthReady) {
                await populateInitialSchedule();
            }
        };

    </script>
</body>
</html>
